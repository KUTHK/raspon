# アセンブリ言語の基礎

冒頭: 最小の命令でハードを直接制御できるようにする。

## 簡単（初心者向け）

### アセンブリの利点

- ハードウェアを直接制御できるため、最適なパフォーマンスや省メモリ化が可能。
- プログラムの動作原理やCPUの仕組みを深く理解できる。
- デバッグや逆アセンブル時に役立つ知識となる。
- OS開発など、低レイヤで必須となる場面がある。

## 普通（上級者向け）

### アセンブリとアセンブル

- **アセンブリ**は、人間が読み書きしやすいニーモニック（命令語）で記述された低水準言語です。CPUごとに命令セットが異なり、機械語への変換が必要です。
- **アセンブル**は、アセンブラというツールを使ってアセンブリ言語のソースコードを機械語（バイナリ）に変換する作業です。

### アセンブリの代表的な命令

- `MOV`：データ転送（例: レジスタやメモリ間の値のコピー）
- `ADD` / `SUB`：加算・減算
- `CMP`：比較（演算結果でフラグを設定）
- `JMP`：無条件ジャンプ
- `JE` / `JNE`：条件付きジャンプ（等しい/等しくない場合に分岐）

### ループ

- ループ処理は、カウンタを使って繰り返しジャンプ命令を実行することで実現します。
- 例（x86系）:
  ```assembly
  MOV CX, 10      ; ループ回数をセット

LOOP_START:
  ; ここに繰り返したい処理を書く（例: レジスタの値をインクリメント）

  SUB CX, CX, 1           ; CXレジスタの値を1減らす。

  BNE LOOP_START  ; CXをデクリメントし、0でなければLOOP_STARTへジャンプ
  ```

### 演算後のNZについて

- アセンブリでは、演算命令の結果に応じてCPUのフラグ（Zero, Negativeなど）が設定されます。
- **N（Negative）**: 結果が負の場合にセットされるフラグ。
- **Z（Zero）**: 結果が0の場合にセットされるフラグ。
- これらのフラグを利用して、条件分岐やループの終了判定などを行います。
- 例: `JZ`（Zeroフラグがセットされていればジャンプ）、`JNZ`（Zeroフラグがクリアならジャンプ）

### よく使うアセンブリ命令一覧
| 命令 | 説明 | 例（ARM系） |
|:---:|:---|:---|
| MOV  | データ転送 | `MOV R0, R1` |
| ADD      | 加算 | `ADD R0, R0, #1` |
| SUB      | 減算 | `SUB R0, R0, #2` |
| INC      | インクリメント（+1） | `ADD R0, R0, #1` |
| DEC      | デクリメント（-1） | `SUB R0, R0, #1` |
| MUL      | 乗算 | `MUL R0, R1, R2` |
| DIV      | 除算（SDIVは符号付き、UDIVは符号なし） | `SDIV R0, R1, R2` |
| AND      | ビットごとのAND演算 | `AND R0, R1, #0xF0` |
| ORR      | ビットごとのOR演算 | `ORR R0, R1, #0xF0` |
| EOR      | ビットごとのXOR演算 | `EOR R0, R1, R2` |
| MVN      | ビットごとの反転（NOT演算） | `MVN R0, R1` |
| LSL      | 左シフト（ビットを左にずらす） | `LSL R0, R1, #1` |
| LSR      | 右シフト（ビットを右にずらす） | `LSR R0, R1, #1` |
| CMP      | 比較（フラグ設定のみ、値は変化しない） | `CMP R0, R1` |
| B        | 無条件ジャンプ | `B LOOP_START` |
| BEQ      | 等しい/ゼロならジャンプ | `BEQ END` |
| BNE      | 等しくない/ゼロでなければジャンプ | `BNE LOOP_START` |
| BGT      | より大きい場合ジャンプ（符号付き） | `BGT LABEL` |
| BLT      | より小さい場合ジャンプ（符号付き） | `BLT LABEL` |
| BL       | サブルーチン呼び出し | `BL FUNC` |
| BX       | サブルーチンから復帰 | `BX LR` |
| PUSH     | スタックに値を積む | `PUSH {R0}` |
| POP      | スタックから値を取り出す | `POP {R1}` |

- ARMアーキテクチャでは命令名や書式がx86系と異なります。
- 基本的な命令を理解することで、ARMアセンブリの流れが把握しやすくなります。

## まとめ

- アセンブリ言語はハードウェアを直接制御できる強力なツールであり、プログラムの動作原理やCPUの仕組みを深く理解するのに役立ちます。
- 基本的な命令やフラグの使い方を押さえることで、より効率的なプログラムやデバッグが可能になります。
- ARMやx86などアーキテクチャごとの違いにも注意しながら、実際に手を動かして学ぶことが重要です。
