# スコアリング

Goal: 得点計算ロジックと表示更新、および勝敗判定 (3 点先取) を定義する。

## ルール概要

先に 3 点 (HK_win_point=3) を獲得したプレイヤーが勝利。勝者は `HK_winner` に 1 (Player1) / 2 (Player2)。引き分けはなし。

## データ / 変数

| 変数 | 役割 | 初期値 | 更新元 | 備考 |
|------|------|--------|--------|------|
| HK_point1 | Player1 の得点 | 0 | HK_add_point1 | 直接書換は避け推奨API使用 |
| HK_point2 | Player2 の得点 | 0 | HK_add_point2 | 〃 |
| HK_win_point | 勝利必要得点 | 3 | 定数(データ領域) | 変更時はドキュメント更新 |
| HK_winner | 勝者ID (0=未決,1/2) | 0 | HK_add_point{1,2} | 確定後リセットまで固定 |

## 得点加算フロー

```text
ゴール判定 -> (どちらのゴールか判定) -> 対応する HK_add_pointX 呼出 ->
内部: HK_pointX++ ; if (HK_pointX >= HK_win_point) HK_winner = X
```

## 表示更新

`score.s:MY_show_score` が 1P 得点を十の位、2P 得点を一の位にパックし `HK_write_number_in` へ書込み → 描画ルーチン。

## レースコンディション / 一貫性

- 同一フレーム内で両者同時得点は想定外（片方のみ）。
- 同時勝利を許す拡張時は `HK_winner` をビットフラグ化案検討。

## リセット手順

新ゲーム開始時に `HK_reset_point` で `HK_point1/2` と `HK_winner` を 0 に戻す。

## 拡張パラメータ案

- 可変勝利点: メニューで選択 → `HK_win_point` 書換 → 表示同期
- デュース制: 差が 2 点付くまで継続 (勝敗判定ロジック変更)

## 不正防止 / 安全性

- 得点は 8bit 範囲を想定 (最大 < 100)。必要ならオーバーフローチェック追加。
- 直接書換検出用にミラー値/チェックサム追加検討。

## TODO

- 画面表示形式 (縦/横 / 区切り文字) の図示
- 可変勝利点導入時の UI 仕様
