# Raspon

Raspberry Pi ä¸Šã§å‹•ä½œã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒªä¸»ä½“ã®ãƒ›ãƒƒã‚±ãƒ¼ã‚²ãƒ¼ãƒ ã€‚
GPIO / PWM ã‚’ç›´æ¥åˆ¶å¾¡ã— 8x8 ãƒ‰ãƒƒãƒˆãƒãƒˆãƒªã‚¯ã‚¹ LED è¡¨ç¤ºã¨ BGM / SE å†ç”Ÿã€å¾—ç‚¹ãƒ»ã‚·ãƒ¼ãƒ³ç®¡ç†ã‚’è¡Œã†ã€‚

## éŠã³æ–¹

> ğŸš¨ é‡è¦: **å…ˆã«é›»æºã‚’è½ã¨ã—ã¦ã‹ã‚‰ SD ã‚«ãƒ¼ãƒ‰ã‚’æŠœã„ã¦ãã ã•ã„ã€‚**

1. SD ã‚«ãƒ¼ãƒ‰ã‚’æŒ¿å…¥ã™ã‚‹ï¼ˆ`kernel7.img` ã‚’å«ã‚€ï¼‰
1. é›»æºã‚’å…¥ã‚Œã‚‹ï¼ˆè‡ªå‹•ã§ `kernel7.img` ã‚’ãƒ–ãƒ¼ãƒˆï¼‰
1. START ç”»é¢ã§ä»»æ„ã®ã‚¹ã‚¤ãƒƒãƒã‚’æŠ¼ã™ â†’ ã‚²ãƒ¼ãƒ é–‹å§‹
1. å·¦å³ã‚¹ã‚¤ãƒƒãƒã§è‡ªåˆ†ã®ãƒ‘ãƒ‰ãƒ«ã‚’æ°´å¹³æ–¹å‘ã«ç§»å‹•
1. ãƒœãƒ¼ãƒ«ã‚’å¼¾ã„ã¦ç›¸æ‰‹ã‚´ãƒ¼ãƒ«ã¸å…¥ã‚Œã‚‹ã¨å¾—ç‚¹
1. è¦å®šå¾—ç‚¹ (3ç‚¹) ç²å¾—ã§ RESULT ç”»é¢
1. ã‚¹ã‚¤ãƒƒãƒæŠ¼ä¸‹ã§å†ã‚¹ã‚¿ãƒ¼ãƒˆ
1. **é›»æºã‚’åˆ‡ã‚‹(å…ˆ)**
1. SDã‚«ãƒ¼ãƒ‰ã‚’æŠœã

| ã‚¹ã‚¤ãƒƒãƒ | æ“ä½œå‰²ã‚Šå½“ã¦ |
|----------|--------------|
| SWé’ | Player1 å·¦ |
| SWç·‘ | Player1 å³ |
| SWèµ¤ | Player2 å·¦ |
| SWé»„ | Player2 å³ |

## ãƒ“ãƒ«ãƒ‰

> âš ï¸ æ³¨æ„: **é›»æºãŒå…¥ã£ãŸçŠ¶æ…‹ã§ SD ã‚«ãƒ¼ãƒ‰ã‚’æŠœãå·®ã—ã—ãªã„ã“ã¨ã€‚**

Makefile ã‚’ä½¿ã£ã¦ `kernel7.img` ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ä»¥ä¸‹ã¯ä¸€èˆ¬çš„ãªä½¿ã„æ–¹ã§ã™ã€‚

å‰æ:

- GNU Arm Embedded Toolchain ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ï¼ˆ`arm-none-eabi-*` ãŒä½¿ãˆã‚‹ã“ã¨ï¼‰

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¾‹ (macOS):

```sh
brew install arm-none-eabi-gcc
```

åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰:

```sh
# Makefile ãŒã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œ
make            # ãƒ“ãƒ«ãƒ‰ï¼ˆkernel7.img ã‚’ç”Ÿæˆï¼‰
make clean      # ç”Ÿæˆç‰©å‰Šé™¤
```

ãƒ“ãƒ«ãƒ‰å®Œäº†å¾Œï¼ˆSD ã¸æ›¸ãè¾¼ã¿ï¼‰:

- Finder ã§ã®æ‰‹é †:
  - SD ã‚’æŒ¿å…¥ã—ã€è¡¨ç¤ºã•ã‚Œã‚‹ BOOT (FAT32) ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’é–‹ã
  - `kernel7.img` ã‚’ ç›´ä¸‹ã«ä¸Šæ›¸ãã‚³ãƒ”ãƒ¼
  - å¿…ãšã€Œå–ã‚Šå‡ºã™ã€æ“ä½œã§ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆ â†’ æœ¬ä½“ã«æŒ¿å…¥ â†’ é›»æºã‚’å…¥ã‚Œã‚‹

- macOS ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¾‹:

```sh
# SD ã®ãƒ‡ãƒã‚¤ã‚¹/ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ç¢ºèª
diskutil list

# ä¾‹: /dev/disk3s1 ãŒ BOOT ã®å ´åˆ
diskutil mount /dev/disk3s1
cp -v kernel7.img /Volumes/boot/kernel7.img   # ãƒ©ãƒ™ãƒ«ãŒç•°ãªã‚‹å ´åˆã¯é©å®œå¤‰æ›´
```

æ³¨æ„:

- æ—¢å­˜ã® `kernel7.img` ã¯å¿…è¦ã«å¿œã˜ã¦ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ã‹ã‚‰ä¸Šæ›¸ã
- **SD ã¯å¿…ãšå®‰å…¨ã«å–ã‚Šå¤–ã—ã¦ã‹ã‚‰æŠœã**ï¼ˆã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆ or å–ã‚Šå‡ºã™ï¼‰
- **æœ¬ä½“ã§ã¯ã€ŒSD ã‚’å…ˆã«æŒ¿ã™ â†’ é›»æºã‚’å…¥ã‚Œã‚‹ã€ã‚’å¾¹åº•**

## ç›®çš„

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›®çš„

- ãƒ¡ãƒ¢ãƒªãƒãƒƒãƒ—I/Oã‚’é€šã˜ã¦ GPIOãƒ»ã‚¿ã‚¤ãƒãƒ»PWM ã‚’ç›´æ¥åˆ¶å¾¡ã™ã‚‹åŠ›ã‚’èº«ã«ã¤ã‘ã‚‹
- 8x8 ãƒãƒˆãƒªã‚¯ã‚¹LEDã‚’è¡Œã‚¹ã‚­ãƒ£ãƒ³ã§é§†å‹•ã—ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡/ã‚·ãƒ¼ãƒ³é·ç§»ã‚’è¨­è¨ˆã™ã‚‹
- PWM ã«ã‚ˆã‚‹ BGM/SE ç”Ÿæˆã¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ¶å¾¡ï¼ˆSEå„ªå…ˆãªã©ï¼‰ã‚’å®Ÿè£…ã—ã¦ç†è§£ã™ã‚‹
- å‰²è¾¼ã¿ã«é ¼ã‚‰ãªã„ãƒãƒ¼ãƒªãƒ³ã‚°ä¸­å¿ƒã®æ™‚é–“è¨­è¨ˆã‚’ä½“é¨“ã—ã€å¿…è¦ã«å¿œã˜ã¦æ‹¡å¼µã§ãã‚‹åŸºç¤ã‚’ä½œã‚‹
- ã‚¢ã‚»ãƒ³ãƒ–ãƒªã§ã®ã‚µãƒ–ãƒ«ãƒ¼ãƒãƒ³åŒ–ãƒ»ãƒ¬ã‚¸ã‚¹ã‚¿ä¿å­˜ãƒ»å‘¼å‡ºè¦ç´„ãƒ»ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ã‚’å®Ÿè·µã™ã‚‹

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

- æ©Ÿå™¨: Raspberry Pi 3
- OS: `_start` (section .init) / `kernel7.img` ã¨ã—ã¦ãƒ–ãƒ¼ãƒˆ
- è¡¨ç¤º: å˜è‰²LEDãƒ»8x8 ãƒ‰ãƒƒãƒˆãƒãƒˆãƒªã‚¯ã‚¹
- éŸ³æº: ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼
- å…¥åŠ›: 4 ã‚¹ã‚¤ãƒƒãƒ

## ãƒ”ãƒ³å‰²ã‚Šå½“ã¦

| ç¨®åˆ¥ | ã‚·ãƒ³ãƒœãƒ« | GPIO |
|------|----------|------|
| å˜è‰² LED | LED_PORT | 10 |
| ã‚¹ãƒ”ãƒ¼ã‚« | (PWM) | 19 |
| COL1..8 | COL1_PORT..COL8_PORT | 27,8,25,23,24,22,17,4 |
| ROW1..8 | ROW1_PORT..ROW8_PORT | 14,15,21,18,12,20,7,16 |
| SW1..4 | SW1_PORT..SW4_PORT | 13,26,5,6 |

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```text
Raspon/
â”œâ”€â”€ README.md
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ introduce.md
â”‚   â””â”€â”€ program_detail.txt
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ Makefile
â””â”€â”€ src/
    â”œâ”€â”€ main.s
    â”œâ”€â”€ GoalJudg.s
    â”œâ”€â”€ init/
    â”œâ”€â”€ include/
    â”œâ”€â”€ audio/
    â”‚   â”œâ”€â”€ play/
    â”‚   â””â”€â”€ data/
    â”œâ”€â”€ display/
    â”œâ”€â”€ game/
    â”‚   â”œâ”€â”€ ball/
    â”‚   â”œâ”€â”€ player/
    â”‚   â”œâ”€â”€ logic/
    â”‚   â””â”€â”€ scenes/
    â””â”€â”€ main/
```

## çŠ¶æ…‹é·ç§» (main.s)

| ãƒ“ãƒƒãƒˆ | çŠ¶æ…‹ | é–¢æ•° | èª¬æ˜ |
|--------|------|------|------|
| 0x1 | START | start_game | é–‹å§‹å¾…ã¡ |
| 0x2 | PLAY  | play_game  | ãƒ¡ã‚¤ãƒ³é€²è¡Œ |
| 0x4 | STOP  | stop_game  | å¾—ç‚¹å¾Œã‚¯ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ  |
| 0x8 | END   | end_game   | çµæœè¡¨ç¤º |

## TODO / èª²é¡Œ

- é›£æ˜“åº¦ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼ˆãƒœãƒ¼ãƒ«é€Ÿåº¦ãƒ»ãƒ‘ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãƒ»å¾—ç‚¹å€ç‡ã®èª¿æ•´ï¼‰
- ã‚µã‚¦ãƒ³ãƒ‰è¡¨ç¾ã®æ‹¡å¼µï¼ˆå’ŒéŸ³å†ç”Ÿï¼‰
- å‰²ã‚Šè¾¼ã¿å‡¦ç†ã«ã‚ˆã‚‹é«˜åº¦åŒ–
- ãƒœãƒ¼ãƒ«è»Œè·¡ã®æ®‹åƒè¡¨ç¤º

## ãƒãƒ‹ãƒ¥ã‚¢ãƒ«

- ãƒŸã‚¯ãƒ­ãƒ³ãƒ»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿
  - [ãƒŸã‚¯ãƒ­ãƒ³ãƒ»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿](https://kut-tktlab.github.io/tiny-cpu-simulator/)ï¼ˆ[äºˆå‚™](http://eris.info.kochi-tech.ac.jp/micron/)ï¼‰
  - [æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ«](https://www.info.kochi-tech.ac.jp/y-takata/micron-manual/micron-manual.pdf)ï¼ˆ[äºˆå‚™](http://eris.info.kochi-tech.ac.jp/micron-manual/micron-manual.pdf)ï¼‰
  - [2é€²ãƒ»10é€²ãƒ»16é€²å¤‰æ›å™¨](https://ytakata69.github.io/bin-dec-hex/)
- i386
  - [Intel 64 and IA-32 Architectures Software Developer's Manual](http://www.intel.co.jp/content/www/jp/ja/processors/architectures-software-developer-manuals.html)
  - [The Netwide Assembler - NASM Manual](http://www.nasm.us/doc/)
- Git, Make
  - [Pro Git book](https://git-scm.com/book/ja)
  - [GNU make](https://www.gnu.org/software/make/manual/html_node/index.html)ï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«ï¼‰ / [GNU Make ç¬¬3ç‰ˆ](http://www.oreilly.co.jp/library/4873112699/)ï¼ˆæ›¸ç±ã®PDFç‰ˆï¼‰
- ARM, BCM2835
  - [RealView(R) Compilation Tools ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ã‚¬ã‚¤ãƒ‰](https://developer.arm.com/documentation/dui0204/j)ï¼ˆGNU as ã¨ã¯åˆ¥ã ãŒ ARM å‘½ä»¤ã®è©³ç´°ï¼‰
  - [Using as (GNU Assembler)](https://sourceware.org/binutils/docs-2.18/as/)ï¼ˆGNU as ã®ç–‘ä¼¼å‘½ä»¤ãªã©ï¼‰
  - [BCM2835 ARM Peripherals](https://www.raspberrypi.org/documentation/hardware/raspberrypi/bcm2835/BCM2835-ARM-Peripherals.pdf) / [Errata](http://elinux.org/BCM2835_datasheet_errata#p141)
  - ï¼ˆBCM283x = Raspberry Pi ã® SoCï¼‰
